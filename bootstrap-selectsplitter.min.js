!function(i){"use strict";function p(e,t){this.init("selectsplitter",e,t)}p.DEFAULTS={template:'<div class="row" data-selectsplitter-wrapper-selector><div class="col-xs-12 col-sm-6"><select class="form-control" data-selectsplitter-firstselect-selector></select></div> \x3c!-- Add the extra clearfix for only the required viewport --\x3e<div class="clearfix visible-xs-block"></div><div class="col-xs-12 col-sm-6"><select class="form-control" data-selectsplitter-secondselect-selector></select></div></div>'},p.prototype.init=function(e,t,r){var s=this;s.type=e,s.$element=i(t),s.$element.hide(),s.options=i.extend({},p.DEFAULTS,r),s.fullCategoryList={};var o=0,a=0;s.$element.find("optgroup").each(function(){s.fullCategoryList[i(this).attr("label")]={};var e=i(this),r=0,l={};i(this).find("option").each(function(){var e=i(this).attr("value"),t=i(this).text();l[i(this).index()]={x:e,y:t},r++}),a<r&&(a=r),s.fullCategoryList[e.attr("label")]=l,o++});var l="";for(var n in s.fullCategoryList)s.fullCategoryList.hasOwnProperty(n)&&(l=l+"<option>"+n+"</option>");s.$element.after(s.options.template),s.$wrapper=s.$element.next("div[data-selectsplitter-wrapper-selector]"),s.$firstSelect=i("select[data-selectsplitter-firstselect-selector]",s.$wrapper),s.$secondSelect=i("select[data-selectsplitter-secondselect-selector]",s.$wrapper);var c=Math.max(o,a,2);c=Math.min(c,10),s.$firstSelect.attr("size",c),s.$secondSelect.attr("size",c),s.$firstSelect.append(l),s.$firstSelect.on("change",i.proxy(s.updateParentCategory,s)),s.$secondSelect.on("change",i.proxy(s.updateChildCategory,s)),s.$selectedOption="",s.currentParentCategory="",s.currentChildCategory="",s.$element.find("option[selected=selected]").length&&(s.$selectedOption=s.$element.find("option[selected=selected]"),s.currentParentCategory=s.$selectedOption.closest("optgroup").attr("label"),s.currentChildCategory=s.$selectedOption.attr("value"),s.$firstSelect.val(s.currentParentCategory),s.$firstSelect.trigger("change"))},p.prototype.updateParentCategory=function(){var e=this;e.currentParentCategory=e.$firstSelect.val(),e.$secondSelect.empty();var t="";for(var r in e.fullCategoryList[e.currentParentCategory])e.fullCategoryList[e.currentParentCategory].hasOwnProperty(r)&&(t=t+'<option value="'+e.fullCategoryList[e.currentParentCategory][r].x+'">'+e.fullCategoryList[e.currentParentCategory][r].y+"</option>");e.$secondSelect.append(t),e.$selectedOption&&e.$secondSelect.find('option[value="'+e.$selectedOption.attr("value")+'"]').attr("selected","selected")},p.prototype.updateChildCategory=function(e){var t=this;t.currentChildCategory=i(e.target).val(),t.$element.find("option[selected=selected]").removeAttr("selected"),t.$element[0].value=t.currentChildCategory,t.$element.find('option[value="'+t.currentChildCategory+'"]').attr("selected","selected"),t.$element.trigger("change"),t.$selectedOption=t.$element.find("option[selected=selected]")},p.prototype.destroy=function(){var e=this;e.$wrapper.remove(),e.$element.removeData(e.type),e.$element.show()},i.fn.selectsplitter=function(l){return this.each(function(){var e=i(this),t=e.data("selectsplitter"),r="object"==typeof l&&l;!t&&"destroy"===l||(t||e.data("selectsplitter",t=new p(this,r)),"string"==typeof l&&t[l]())})},i.fn.selectsplitter.Constructor=p}(jQuery);
